<div class="page-title mb-4">
  Bulk Upload Additional Billing
  <p class="mt-1 text-sm font-normal text-muted-foreground">
    Upload a CSV file for bulk additional billing. Only .csv files are allowed.
  </p>
</div>

<div class="card">
  <app-file-uploader
    class="block"
    [acceptedFileTypes]="'.csv'"
    [maxFileSize]="10"
    [sampleFileUrl]="getSampleFileUrl()"
    [resetTrigger]="resetTrigger()"
    (fileSelected)="onFileSelected($event)"
    (uploadClicked)="onUploadClick()"
    (cancelClicked)="onCancelClick()"
  />
</div>

<div class="card mt-4 block">
  <div class="mb-3 flex items-center justify-between gap-3">
    <div class="text-lg font-medium text-foreground">Previous Upload Details</div>
  </div>

  <app-table
    [headers]="headers()"
    [data]="tableData()"
    [paginationRequired]="true"
    [totalRecords]="totalRecords()"
    [defaultPageSize]="pageSize()"
    (pageChange)="onPageChange($event)"
  >
    <ng-template #rowTemplate let-row>
      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis pl-6">{{ row.fileId }}</td>

      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis">
        @if (row.errorFileUrl) {
          <button
            type="button"
            class="inline-flex items-center justify-center rounded p-1.5 text-destructive hover:bg-destructive/10 hover:text-destructive/90 transition-colors"
            (click)="downloadFile(row.errorFileUrl)"
            title="Download error file"
          >
            <ng-icon name="lucideDownload" class="size-5" />
            <span class="sr-only">Download error file</span>
          </button>
        } @else {
          <span class="text-muted-foreground">-</span>
        }
      </td>

      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis">{{ row.successCount }}</td>
      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis">{{ row.failedCount }}</td>
      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis">{{ row.uploadedBy }}</td>
      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis">{{ row.date }}</td>

      <td class="py-3.5 align-middle whitespace-nowrap overflow-hidden text-ellipsis pr-6">
        <span
          class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium"
          [ngClass]="{
            'bg-yellow-500/15 text-yellow-700 dark:text-yellow-300': (row.status || '').toLowerCase() === 'pending',
            'bg-green-500/15 text-green-700 dark:text-green-300': ['processing', 'completed'].includes((row.status || '').toLowerCase()),
            'bg-red-500/15 text-red-700 dark:text-red-300': (row.status || '').toLowerCase() === 'failed'
          }"
        >
          {{ row.status }}
        </span>
      </td>
    </ng-template>
  </app-table>
</div>
